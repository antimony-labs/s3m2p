version: '3.8'
services:
  keploy:
    image: keploy/keploy:latest
    container_name: keploy
    network_mode: host
    environment:
      - KEPLOY_MODE=${KEPLOY_MODE:-record}
      - KEPLOY_CONFIG_PATH=/app/keploy.yaml
    volumes:
      - ./keploy.yaml:/app/keploy.yaml:ro
      - ./keploy:/app/keploy
    restart: unless-stopped

  app:
    build:
      context: .
      dockerfile: Dockerfile.keploy
    container_name: app-under-test
    depends_on:
      - keploy
    environment:
      - NODE_ENV=production
    network_mode: host
    restart: unless-stopped

